<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tableau de Bord</title>
  <script src="https://cdn.tailwindcss.com/3.4.16"></script>
  <script>tailwind.config={theme:{extend:{colors:{primary:'#5b67e0',secondary:'#6366f1'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
  <style> :where([class^="ri-"])::before { content: "\f3c2"; } </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f9fafb;
    }
    .sidebar-fixed {
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      transition: transform 0.3s ease;
      z-index: 50;
    }
    .sidebar-hidden {
      transform: translateX(-100%);
    }
    .task-completed {
      text-decoration: line-through;
      color: #9ca3af !important;
    }
    .task-date-completed {
      color: #d1d5db !important;
    }
    .completed-task {
      opacity: 0.7;
      background-color: #f3f4f6;
    }
    #documentsSubmenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      padding-left: 3rem;
    }
    #documentsSubmenu.show {
      max-height: 500px;
    }
    #addTaskModal, #allAppointmentsModal, #allPatientsModal, #patientDossierModal {
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    #addTaskModal.hidden, #allAppointmentsModal.hidden, #allPatientsModal.hidden, #patientDossierModal.hidden {
      opacity: 0;
      transform: scale(0.95);
      pointer-events: none;
    }
    .appointment {
      position: absolute;
      left: 5px;
      right: 5px;
      border-radius: 8px;
      padding: 8px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      height: auto;
    }
    .appointment:hover {
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transform: translateY(-1px);
    }
    .appointment.selected {
      box-shadow: 0 0 0 2px #4f46e5;
    }
    .custom-checkbox {
      position: relative;
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #d1d5db;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .custom-checkbox.checked {
      background-color: #4f46e5;
      border-color: #4f46e5;
    }
    .custom-checkbox.checked::after {
      content: '';
      position: absolute;
      left: 6px;
      top: 2px;
      width: 6px;
      height: 10px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }
    .completed-task {
      opacity: 0.7;
      background-color: #f3f4f6;
    }
    #allAppointmentsModal .max-h-\[80vh\], #allPatientsModal .max-h-\[80vh\] {
      max-height: 80vh;
    }
    .patient-details {
      display: none;
      padding: 10px;
      background-color: #f9fafb;
      border-radius: 8px;
      margin-top: 8px;
    }
    .show-details .patient-details {
      display: block;
    }
    .rotate-180 {
      transform: rotate(180deg);
    }
    .dossier-tab-button.active {
      border-bottom: 2px solid #4f46e5;
      color: #4f46e5;
    }
    .dossier-tab-content {
      display: none;
    }
    .dossier-tab-content.active {
      display: block;
    }
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    /* Style pour le rendez-vous actif */
    #activeAppointment {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
    }

    #activeAppointment:hover {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    #rescheduleContainer, #confirmContainer {
      transition: all 0.3s ease;
      max-height: 0;
      opacity: 0;
      overflow: hidden;
    }

    #rescheduleContainer.hidden, #confirmContainer.hidden {
      max-height: 0;
      opacity: 0;
      margin-top: 0;
      padding: 0;
    }

    #rescheduleContainer:not(.hidden), #confirmContainer:not(.hidden) {
      max-height: 200px;
      opacity: 1;
      margin-top: 0.75rem;
    }

    /* Animation pour les boutons */
    #confirmBtn, #cancelBtn, #rescheduleBtn, #validateRescheduleBtn, #validateConfirmBtn {
      transition: transform 0.2s ease, background-color 0.2s ease;
    }

    #confirmBtn:hover, #cancelBtn:hover, #rescheduleBtn:hover, #validateRescheduleBtn:hover, #validateConfirmBtn:hover {
      transform: translateY(-1px);
    }

    #confirmBtn:active, #cancelBtn:active, #rescheduleBtn:active, #validateRescheduleBtn:active, #validateConfirmBtn:active {
      transform: translateY(1px);
    }
    .burger-btn {
      display: flex;
      cursor: pointer;
      padding: 2px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    .burger-btn:hover {
      background-color: #f3f4f6;
    }
    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: white;
      border-left: 4px solid;
      border-radius: 12px;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
      padding: 1rem 1.25rem;
      display: flex;
      align-items: center;
      max-width: 340px;
      transform: translateX(120%);
      transition: transform 0.3s ease-out;
      z-index: 1000;
    }
    .notification.show {
      transform: translateX(0);
    }
    .notification-icon {
      margin-right: 0.875rem;
      display: flex;
      align-items: center;
    }
    .notification-content {
      flex-grow: 1;
    }
    .notification-title {
      font-weight: 500;
      margin-bottom: 0.25rem;
      color: #1f2937;
      font-size: 0.95rem;
    }
    .notification-message {
      font-size: 0.875rem;
      color: #4b5563;
      line-height: 1.4;
    }
    .notification-close {
      margin-left: 0.875rem;
      cursor: pointer;
      color: #9ca3af;
      font-size: 1.25rem;
      line-height: 1;
      transition: color 0.2s;
    }
    .notification-close:hover {
      color: #6b7280;
    }
    .status-confirme {
      background-color: rgba(16, 185, 129, 0.1);
      color: rgb(16, 185, 129);
    }
    .status-annule {
      background-color: rgba(239, 68, 68, 0.1);
      color: rgb(239, 68, 68);
    }
    .status-reporte {
      background-color: rgba(245, 158, 11, 0.1);
      color: rgb(245, 158, 11);
    }
    .records-tab-button.active {
      color: #4f46e5;
      border-bottom: 2px solid #4f46e5;
    }
    .records-tab-content {
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .records-tab-content.active {
      display: block;
      opacity: 1;
    }
    .disabled-input {
    background-color: #f3f4f6 !important;
    color: #6b7280 !important;
    cursor: not-allowed !important;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex">
<!-- Sidebar (Menu) fixe -->
<div id="sidebar" class="bg-white w-64 border-r border-gray-200 flex flex-col sidebar-fixed">
  <div class="p-5 border-b border-gray-200 flex justify-between items-center">
    <h1 class="text-2xl font-['Pacifico'] text-primary">Tableau de Bord</h1>
    <button id="closeSidebarBtn" class="burger-btn text-gray-600 md:block">
        <i class="ri-close-line text-xl"></i>
    </button>
  </div>
  
  <nav class="flex-1 overflow-y-auto py-4">
    <ul>
      <li class="mb-1">
        <a href="#" class="flex items-center px-4 py-3 text-gray-700 bg-purple-50 border-l-4 border-primary">
          <div class="w-6 h-6 flex items-center justify-center mr-3 text-primary">
            <i class="ri-dashboard-line"></i>
          </div>
          <span>Tableau de Bord</span>
        </a>
      </li>
      <li class="mb-1">
        <a href="/patients/page" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50">
          <div class="w-6 h-6 flex items-center justify-center mr-3 text-gray-500">
            <i class="ri-user-line"></i>
          </div>
          <span>Patients</span>
        </a>
      </li>
      <li class="mb-1">
        <a href="/rendezvous/page" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50">
          <div class="w-6 h-6 flex items-center justify-center mr-3 text-gray-500">
            <i class="ri-calendar-2-line"></i>
          </div>
          <span>Rendez-Vous</span>
        </a>
      </li>
      <li class="mb-1">
        <button id="documentsDropdown" class="w-full flex items-center justify-between px-4 py-3 text-gray-600 hover:bg-gray-50">
          <div class="flex items-center">
            <div class="w-6 h-6 flex items-center justify-center mr-3 text-gray-500">
              <i class="ri-folder-line"></i>
            </div>
            <span>Documents</span>
          </div>
          <div class="w-5 h-5 flex items-center justify-center text-gray-500 transition-transform duration-200">
            <i id="dropdownArrow" class="ri-arrow-down-s-line"></i>
          </div>
        </button>
        <ul id="documentsSubmenu" class="pl-4">
          <li class="mb-1">
            <a href="/Facture" class="block py-2 text-sm text-gray-600 hover:text-primary pl-8">
              Factures
            </a>
          </li>
          <li class="mb-1">
            <a href="/devis" class="block py-2 text-sm text-gray-600 hover:text-primary pl-8">
                Devis
            </a>
          </li>
          <li class="mb-1">
            <a href="#" class="block py-2 text-sm text-gray-600 hover:text-primary pl-8">
              Anamnèse
            </a>
          </li>
          <li>
            <a href="#" class="block py-2 text-sm text-gray-600 hover:text-primary pl-8">
              Compte rendu
            </a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/Revenus" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50">
          <div class="w-6 h-6 flex items-center justify-center mr-3 text-gray-500">
            <i class="ri-line-chart-line"></i>
          </div>
          <span>Mes Revenus</span>
        </a>
      </li>
    </ul>
  </nav>

  <div class="p-4 border-t border-gray-200 hover:bg-gray-50 cursor-pointer">
    <div class="flex items-center">
        <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center mr-3">
            <i class="ri-user-line text-gray-600"></i>
        </div>
        <div>
            <div class="text-sm font-medium">Mekouar Zineb</div>
            <div class="text-xs text-gray-500">psychomotricienne</div>
        </div>
    </div>
</div>
</div>

<!-- Contenu principal avec marge pour la sidebar fixe -->
<div id="mainContent" class="flex-1 flex flex-col overflow-hidden ml-64">
  <!-- Top Header -->
  <header class="bg-white border-b border-gray-200 py-4 px-6 flex justify-between items-center">
    <div class="flex items-center">
      <button id="openSidebarBtn" class="burger-btn text-gray-600 mr-6 ">
        <i class="ri-menu-line text-xl"></i>
      </button>
      <h2 class="text-xl font-semibold text-gray-800">Tableau de Bord</h2>
      <div class="ml-6 text-sm text-gray-500">
        <span id="currentDate">Mercredi, 2 Avril 2025</span>
      </div>
    </div>
    <div class="flex items-center space-x-4">
      <div class="relative">
        <input type="text" placeholder="Rechercher..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary text-sm">
        <div class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 flex items-center justify-center text-gray-500">
          <i class="ri-search-line"></i>
        </div>
      </div>
      <button id="newPatientBtn" class="bg-primary text-white px-4 py-2 rounded-button flex items-center whitespace-nowrap">
        <div class="w-5 h-5 flex items-center justify-center mr-2">
          <i class="ri-add-line"></i>
        </div>
        <span>Nouveau Patient</span>
      </button>
    </div>
  </header>

  <!-- Dashboard Content -->
  <div class="flex-1 overflow-auto p-6 bg-gray-50">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium text-gray-800">Rendez-Vous</h3>
          <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
            <i class="ri-calendar-2-line"></i>
          </div>
        </div>
        <div class="flex items-end justify-between">
          <div>
            <p class="text-3xl font-bold text-gray-800">8</p>
            <p class="text-sm text-gray-500">Aujourd'hui</p>
          </div>
        </div>
      </div>
      
      <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium text-gray-800">Patients</h3>
          <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600">
            <i class="ri-user-line"></i>
          </div>
        </div>
        <div class="flex items-end justify-between">
          <div>
            <p class="text-3xl font-bold text-gray-800">45</p>
            <p class="text-sm text-gray-500">Actifs</p>
          </div>
        </div>
      </div>
      
      <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium text-gray-800">Rendez-Vous Annulés</h3>
          <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600">
            <i class="ri-calendar-close-line"></i>
          </div>
        </div>
        <div class="flex items-end justify-between">
          <div>
            <p class="text-3xl font-bold text-gray-800">3</p>
            <p class="text-sm text-gray-500">Ce mois</p>
          </div>
        </div>
      </div>
      
      <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium text-gray-800">Revenus</h3>
          <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600">
            <i class="ri-money-dollar-circle-line"></i>
          </div>
        </div>
        <div class="flex items-end justify-between">
          <div>
            <p class="text-3xl font-bold text-gray-800">1 200 DH</p>
            <p class="text-sm text-gray-500">Ce mois</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Prochains Rendez-vous et Tâches & Rappels -->
    <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 mb-6">
      <!-- Prochains Rendez-vous (3 colonnes) -->
      <div class="lg:col-span-3 bg-white p-6 rounded-lg shadow-sm border border-gray-100">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-medium text-gray-800">Prochains Rendez-vous</h3>
          <button id="viewAllAppointmentsBtn" class="text-primary text-sm hover:underline">Voir tous</button>
        </div>
        <div id="appointmentsContainer" class="space-y-4">
          <!-- Rendez-vous actif (Mekouar Zineb) -->
          <div id="activeAppointment" class="flex flex-col p-4 rounded-lg bg-gray-50 border border-gray-100 transition-all">
            <div class="flex items-start">
              <div class="w-10 h-10 rounded-full bg-purple-200 flex items-center justify-center text-purple-700 mr-3 flex-shrink-0">
                <span class="font-medium">MZ</span>
              </div>
              <div class="flex-1 min-w-0">
                <p class="font-medium text-gray-800 truncate">Mekouar Zineb</p>
                <p class="text-sm text-gray-600">Aujourd'hui, 10:00 - 11:00</p>
                <p class="text-xs text-gray-500 mt-1">Séance de psychomotricité</p>
              </div>
              <div class="ml-2 flex items-center">
                <span id="appointmentStatus" class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">En cours</span>
              </div>
            </div>
            
            <!-- Boutons d'action centrés -->
            <div class="flex flex-wrap gap-2 mt-3 justify-center">
              <button id="confirmBtn" class="px-3 py-1.5 bg-green-600 text-white rounded-button text-sm hover:bg-green-700 transition-colors">
                Confirmer
              </button>
              <button id="cancelBtn" class="px-3 py-1.5 bg-red-600 text-white rounded-button text-sm hover:bg-red-700 transition-colors">
                Annuler
              </button>
              <button id="rescheduleBtn" class="px-3 py-1.5 bg-blue-600 text-white rounded-button text-sm hover:bg-blue-700 transition-colors">
                Reporter
              </button>
            </div>
            
            <!-- Zone de commentaire pour la confirmation (initialement cachée) -->
            <div id="confirmContainer" class="mt-3 p-3 bg-white rounded-lg border border-gray-200 hidden">
              <label for="confirmNote" class="block text-sm font-medium text-gray-700 mb-1">Observation:</label>
              <textarea id="confirmNote" class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" rows="2"></textarea>
              <div class="flex justify-end mt-2">
                <button id="validateConfirmBtn" class="px-3 py-1.5 bg-green-600 text-white rounded-button text-sm hover:bg-green-700 transition-colors">
                  Valider
                </button>
              </div>
            </div>
            
            <!-- Zone de report sans observation (initialement cachée) -->
            <div id="rescheduleContainer" class="mt-3 p-3 bg-white rounded-lg border border-gray-200 hidden">
              <div class="grid grid-cols-2 gap-2 mb-2">
                <div>
                  <label for="rescheduleDate" class="block text-sm font-medium text-gray-700 mb-1">Nouvelle date:</label>
                  <input type="date" id="rescheduleDate" class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                </div>
                <div>
                  <label for="rescheduleTime" class="block text-sm font-medium text-gray-700 mb-1">Nouvelle heure:</label>
                  <input type="time" id="rescheduleTime" class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                </div>
              </div>
              <div class="flex justify-end mt-2">
                <button id="validateRescheduleBtn" class="px-3 py-1.5 bg-primary text-white rounded-button text-sm hover:bg-primary/90 transition-colors">
                  Valider le report
                </button>
              </div>
            </div>
          </div>
          
          <!-- Rendez-vous normal (Jean Dupont) -->
          <div class="appointment-item flex items-start p-3 rounded-lg hover:bg-gray-50 border border-gray-100">
            <div class="w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center text-blue-700 mr-3 flex-shrink-0">
              <span class="font-medium">JD</span>
            </div>
            <div class="flex-1 min-w-0">
              <p class="font-medium text-gray-800 truncate">Jean Dupont</p>
              <p class="text-sm text-gray-600">Demain, 09:00 - 09:30</p>
              <p class="text-xs text-gray-500 mt-1">Première consultation</p>
            </div>
          </div>
          
          <!-- Rendez-vous normal (Alice Durand) -->
          <div class="appointment-item flex items-start p-3 rounded-lg hover:bg-gray-50 border border-gray-100">
            <div class="w-10 h-10 rounded-full bg-green-200 flex items-center justify-center text-green-700 mr-3 flex-shrink-0">
              <span class="font-medium">AD</span>
            </div>
            <div class="flex-1 min-w-0">
              <p class="font-medium text-gray-800 truncate">Alice Durand</p>
              <p class="text-sm text-gray-600">Demain, 11:30 - 12:00</p>
              <p class="text-xs text-gray-500 mt-1">Séance de suivi</p>
            </div>
          </div>
          
          <!-- Nouveau patient (Sophie Martin) -->
          <div class="appointment-item flex items-start p-3 rounded-lg hover:bg-gray-50 border border-gray-100">
            <div class="w-10 h-10 rounded-full bg-pink-200 flex items-center justify-center text-pink-700 mr-3 flex-shrink-0">
              <span class="font-medium">SM</span>
            </div>
            <div class="flex-1 min-w-0">
              <p class="font-medium text-gray-800 truncate">Sophie Martin</p>
              <p class="text-sm text-gray-600">Demain, 14:00 - 14:45</p>
              <p class="text-xs text-gray-500 mt-1">Évaluation initiale</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tâches & Rappels (2 colonnes - élargie) -->
      <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-sm border border-gray-100">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-medium text-gray-800">Tâches & Rappels</h3>
          <button id="addTaskBtn" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-gray-200">
            <i class="ri-add-line"></i>
          </button>
        </div>
        <div id="tasksContainer" class="space-y-3">
          <div class="flex items-center p-3 rounded-lg bg-gray-50 border border-gray-100">
            <div class="w-5 h-5 flex items-center justify-center mr-3">
              <input type="checkbox" checked class="form-checkbox h-4 w-4 text-primary rounded focus:ring-primary" onchange="toggleTask(this)">
            </div>
            <div class="flex-1">
              <p class="text-sm text-gray-800 task-text">Appeler patient Dupont</p>
              <p class="text-xs text-gray-500 task-date">Aujourd'hui, 10:00</p>
            </div>
          </div>
          
          <div class="flex items-center p-3 rounded-lg hover:bg-gray-50 border border-gray-100">
            <div class="w-5 h-5 flex items-center justify-center mr-3">
              <input type="checkbox" class="form-checkbox h-4 w-4 text-primary rounded focus:ring-primary" onchange="toggleTask(this)">
            </div>
            <div class="flex-1">
              <p class="text-sm text-gray-800 task-text">Préparer dossier pour séance</p>
              <p class="text-xs text-gray-500 task-date">Aujourd'hui, 16:00</p>
            </div>
          </div>
          
          <div class="flex items-center p-3 rounded-lg hover:bg-gray-50 border border-gray-100">
            <div class="w-5 h-5 flex items-center justify-center mr-3">
              <input type="checkbox" class="form-checkbox h-4 w-4 text-primary rounded focus:ring-primary" onchange="toggleTask(this)">
            </div>
            <div class="flex-1">
              <p class="text-sm text-gray-800 task-text">Envoyer factures</p>
              <p class="text-xs text-gray-500 task-date">Demain, 09:00</p>
            </div>
          </div>
          
          <div class="flex items-center p-3 rounded-lg hover:bg-gray-50 border border-gray-100">
            <div class="w-5 h-5 flex items-center justify-center mr-3">
              <input type="checkbox" class="form-checkbox h-4 w-4 text-primary rounded focus:ring-primary" onchange="toggleTask(this)">
            </div>
            <div class="flex-1">
              <p class="text-sm text-gray-800 task-text">Réunion équipe</p>
              <p class="text-xs text-gray-500 task-date">03/04/2025, 14:00</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Section Patients Récents (vide initialement) -->
    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-medium text-gray-800">Patients Récents</h3>
        <button id="viewAllPatientsBtn" class="text-primary text-sm hover:underline">Voir tous</button>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full">
          <thead>
            <tr class="border-b border-gray-200">
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Patient</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dernière visite</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
              <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody id="recentPatientsTableBody" class="divide-y divide-gray-200">
            <!-- Les patients seront ajoutés dynamiquement ici -->
            <tr>
              <td colspan="4" class="px-4 py-6 text-center text-gray-500">Aucun patient récent</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Add Task Modal -->
<div id="addTaskModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
    <div class="p-6 border-b border-gray-200">
      <div class="flex justify-between items-center">
        <h3 class="text-lg font-semibold text-gray-900">Ajouter une tâche</h3>
        <button id="closeTaskBtn" class="text-gray-400 hover:text-gray-500">
          <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-close-line"></i>
          </div>
        </button>
      </div>
    </div>
    <div class="p-6">
      <form id="addTaskForm">
        <div class="mb-4">
          <label for="taskText" class="block text-sm font-medium text-gray-700 mb-1">Description de la tâche</label>
          <input type="text" id="taskText" class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="mb-4">
            <label for="taskDay" class="block text-sm font-medium text-gray-700 mb-1">Jour</label>
            <select id="taskDay" class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
              <option value="today">Aujourd'hui</option>
              <option value="tomorrow">Demain</option>
              <option value="other">Autre date</option>
            </select>
          </div>
          <div class="mb-4" id="specificDateContainer" style="display: none;">
            <label for="specificDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
            <input type="date" id="specificDate" class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
          </div>
          <div class="mb-4">
            <label for="taskHour" class="block text-sm font-medium text-gray-700 mb-1">Heure</label>
            <input type="time" id="taskHour" class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
          </div>
        </div>
      </form>
    </div>
    <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
      <button id="submitTaskBtn" class="px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90 whitespace-nowrap">
        Ajouter
      </button>
    </div>
  </div>
</div>

<!-- Modal pour tous les rendez-vous -->
<div id="allAppointmentsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl mx-4 max-h-[80vh] overflow-y-auto">
    <div class="p-6 border-b border-gray-200 sticky top-0 bg-white z-10">
      <div class="flex justify-between items-center">
        <h3 class="text-lg font-semibold text-gray-900">Tous les rendez-vous du jour</h3>
        <button id="closeAllAppointmentsBtn" class="text-gray-400 hover:text-gray-500">
          <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-close-line"></i>
          </div>
        </button>
      </div>
    </div>
    <div class="p-6">
      <div id="allAppointmentsContainer" class="space-y-4">
        <!-- Rendez-vous 1 -->
        <div class="flex items-start p-4 rounded-lg border border-gray-100">
          <div class="w-10 h-10 rounded-full bg-purple-200 flex items-center justify-center text-purple-700 mr-3 flex-shrink-0">
            <span class="font-medium">MZ</span>
          </div>
          <div class="flex-1 min-w-0">
            <p class="font-medium text-gray-800">Mekouar Zineb</p>
            <p class="text-sm text-gray-600">Aujourd'hui, 10:00 - 11:00</p>
            <p class="text-xs text-gray-500 mt-1">Séance de psychomotricité</p>
          </div>
        </div>
        
        <!-- Rendez-vous 2 -->
        <div class="flex items-start p-4 rounded-lg border border-gray-100">
          <div class="w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center text-blue-700 mr-3 flex-shrink-0">
            <span class="font-medium">JD</span>
          </div>
          <div class="flex-1 min-w-0">
            <p class="font-medium text-gray-800">Jean Dupont</p>
            <p class="text-sm text-gray-600">Aujourd'hui, 14:00 - 14:30</p>
            <p class="text-xs text-gray-500 mt-1">Première consultation</p>
          </div>
        </div>
        
        <!-- Rendez-vous 3 -->
        <div class="flex items-start p-4 rounded-lg border border-gray-100">
          <div class="w-10 h-10 rounded-full bg-green-200 flex items-center justify-center text-green-700 mr-3 flex-shrink-0">
            <span class="font-medium">AD</span>
          </div>
          <div class="flex-1 min-w-0">
            <p class="font-medium text-gray-800">Alice Durand</p>
            <p class="text-sm text-gray-600">Aujourd'hui, 16:00 - 16:45</p>
            <p class="text-xs text-gray-500 mt-1">Séance de suivi</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal pour tous les patients -->
<div id="allPatientsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 max-h-[80vh] overflow-y-auto">
    <div class="p-6 border-b border-gray-200 sticky top-0 bg-white z-10">
      <div class="flex justify-between items-center">
        <h3 class="text-lg font-semibold text-gray-900">Liste des patients</h3>
        <button id="closeAllPatientsBtn" class="text-gray-400 hover:text-gray-500">
          <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-close-line"></i>
          </div>
        </button>
      </div>
    </div>
    <div class="p-6">
      <div class="overflow-x-auto">
        <table class="min-w-full">
          <thead>
            <tr class="border-b border-gray-200">
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Patient</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dernière visite</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
              <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="w-8 h-8 rounded-full bg-indigo-200 flex items-center justify-center text-indigo-700 mr-3">
                    <span class="text-xs font-medium">MZ</span>
                  </div>
                  <div>
                    <p class="font-medium text-gray-800">Mekouar Zineb</p>
                    <p class="text-xs text-gray-500">32 ans</p>
                  </div>
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">01/04/2025</td>
              <td class="px-4 py-3 whitespace-nowrap">
                <span class="px-2 py-1 text-xs rounded-full status-confirme">Confirmé</span>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-right text-sm">
                <button class="text-primary hover:text-primary/80 voir-dossier-btn" data-patient="Mekouar Zineb" data-age="32" data-avatar="MZ" data-avatar-bg="bg-indigo-200">Voir dossier</button>
              </td>
            </tr>
            <tr>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="w-8 h-8 rounded-full bg-blue-200 flex items-center justify-center text-blue-700 mr-3">
                    <span class="text-xs font-medium">JD</span>
                  </div>
                  <div>
                    <p class="font-medium text-gray-800">Jean Dupont</p>
                    <p class="text-xs text-gray-500">45 ans</p>
                  </div>
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">31/03/2025</td>
              <td class="px-4 py-3 whitespace-nowrap">
                <span class="px-2 py-1 text-xs rounded-full status-annule">Annulé</span>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-right text-sm">
                <button class="text-primary hover:text-primary/80 voir-dossier-btn" data-patient="Jean Dupont" data-age="45" data-avatar="JD" data-avatar-bg="bg-blue-200">Voir dossier</button>
              </td>
            </tr>
            <tr>
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="w-8 h-8 rounded-full bg-green-200 flex items-center justify-center text-green-700 mr-3">
                    <span class="text-xs font-medium">AD</span>
                  </div>
                  <div>
                    <p class="font-medium text-gray-800">Alice Durand</p>
                    <p class="text-xs text-gray-500">28 ans</p>
                  </div>
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">30/03/2025</td>
              <td class="px-4 py-3 whitespace-nowrap">
                <span class="px-2 py-1 text-xs rounded-full status-reporte">Reporté</span>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-right text-sm">
                <button class="text-primary hover:text-primary/80 voir-dossier-btn" data-patient="Alice Durand" data-age="28" data-avatar="AD" data-avatar-bg="bg-green-200">Voir dossier</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal pour le dossier patient -->
<div id="patientDossierModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden modal">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden flex flex-col">
    <div class="p-6 border-b border-gray-200 flex justify-between items-center">
      <div class="flex items-center flex-grow">
        <div id="dossierPatientAvatar" class="w-10 h-10 rounded-full bg-indigo-200 flex items-center justify-center text-white mr-3">
          MZ
        </div>
        <div class="flex-grow">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-semibold text-gray-900" id="dossierPatientName">Nom Patient</h3>
            <div class="flex items-center space-x-4">
              <span class="text-sm text-gray-700" id="patientRecordSessions">0 séances</span>
            </div>
          </div>
          <div class="flex items-center mt-1">
            <div class="text-sm text-gray-500 mr-3" id="dossierPatientAge">-- ans</div>
          </div>
        </div>
      </div>
      <button id="closeDossierBtn" class="text-gray-400 hover:text-gray-500 ml-4">
        <div class="w-6 h-6 flex items-center justify-center">
          <i class="ri-close-line"></i>
        </div>
      </button>
    </div>

    <div class="p-6 overflow-y-auto">
      <!-- Tabs -->
      <div class="border-b border-gray-200 mb-6">
        <div class="flex -mb-px">
          <button class="records-tab-button active px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 mr-4" data-tab="sessionsTab">Séances</button>
          <button class="records-tab-button px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 mr-4" data-tab="anamneseTab">Anamnèse</button>
          <button class="records-tab-button px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="compteRenduTab">Compte rendu</button>
        </div>
      </div>

      <!-- Tab: Séances -->
      <div class="records-tab-content active" id="sessionsTab">
        <div class="flex justify-between items-center mb-4">
          <div class="flex items-center space-x-4 w-full">
            <div class="w-full bg-gray-200 rounded-full h-2 max-w-[300px]">
              <div class="bg-primary h-2 rounded-full" id="patientRecordSessionsProgress" style="width: 0%"></div>
            </div>
            <span class="text-sm text-gray-700 whitespace-nowrap" id="patientRecordSessionsText">0/0 séances</span>
          </div>
          <button id="addSessionBtn" class="px-3 py-1.5 bg-primary text-white rounded-button text-sm flex items-center whitespace-nowrap">
            <i class="ri-add-line mr-1"></i> Ajouter
          </button>
        </div>
        <div class="mb-4">
          <h4 class="text-md font-medium text-gray-800">Historique des séances</h4>
        </div>
        <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
          <div class="divide-y divide-gray-100" id="patientSessionHistory">
            <div class="p-4 text-center text-gray-500">Aucune séance enregistrée.</div>
          </div>
        </div>
      </div>

      <!-- Tab: Anamnèse -->
      <div class="records-tab-content hidden" id="anamneseTab">
        <div class="mb-4 flex justify-between items-center">
          <h4 class="text-md font-medium text-gray-800">Historique des anamnèses</h4>
          <button class="px-3 py-1.5 bg-primary text-white rounded-button text-sm flex items-center whitespace-nowrap" id="newAnamneseForPatientBtn">
            <i class="ri-add-line mr-1"></i> Nouvelle anamnèse
          </button>
        </div>
        <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
          <div class="divide-y divide-gray-200" id="anamneseList">
            <div class="p-4 text-center text-gray-500">Aucune anamnèse enregistrée.</div>
          </div>
        </div>
      </div>

      <!-- Tab: Compte rendu -->
      <div class="records-tab-content hidden" id="compteRenduTab">
        <div class="mb-4 flex justify-between items-center">
          <h4 class="text-md font-medium text-gray-800">Comptes rendus</h4>
          <button class="px-3 py-1.5 bg-primary text-white rounded-button text-sm flex items-center whitespace-nowrap" id="newCompteRenduForPatientBtn">
            <i class="ri-add-line mr-1"></i> Nouveau compte rendu
          </button>
        </div>
        <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
          <div class="divide-y divide-gray-200" id="compteRenduList">
            <div class="p-4 text-center text-gray-500">Aucun compte rendu enregistré.</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal pour ajouter des séances -->
<div id="addSeancesModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
    <div class="p-6 border-b border-gray-200 flex justify-between items-center">
      <h3 class="text-lg font-semibold text-gray-900">Ajouter des séances</h3>
      <button id="closeAddSeancesBtn" class="text-gray-400 hover:text-gray-500">
        <div class="w-6 h-6 flex items-center justify-center">
          <i class="ri-close-line"></i>
        </div>
      </button>
    </div>
    <div class="p-6 overflow-y-auto max-h-[70vh]">
      <form id="addSeancesForm">
        <div class="mb-4">
          <label class="text-xs text-gray-500">Nombre de séances actuel</label>
          <input type="number" id="currentSeancesDisplay" class="w-full px-3 py-2 border border-gray-300 rounded-button disabled-input mb-2" readonly>
        </div>
        <div class="mb-4">
          <label for="additionalSeances" class="block text-sm font-medium text-gray-700 mb-1">Nombre de séances à ajouter</label>
          <input type="number" id="additionalSeances" class="w-full px-3 py-2 border border-gray-300 rounded-button focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" min="1" value="1">
        </div>
        <div class="mb-4">
          <label class="text-xs text-gray-500">Nombre total de séances</label>
          <input type="number" id="totalSeancesDisplay" class="w-full px-3 py-2 border border-gray-300 rounded-button disabled-input mt-2" readonly>
        </div>
      </form>
    </div>
    <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
      <button id="cancelAddSeancesBtn" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-button hover:bg-gray-50 whitespace-nowrap">
        Annuler
      </button>
      <button id="submitAddSeancesBtn" class="px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90 whitespace-nowrap">
        Confirmer
      </button>
    </div>
  </div>
</div>

<!-- Modal de confirmation pour les séances -->
<div id="seancesConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
    <div class="p-6">
      <div class="flex items-center justify-center mb-4">
        <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
          <i class="ri-question-line ri-xl"></i>
        </div>
      </div>
      <h3 class="text-lg font-medium text-center mb-2">Confirmer l'ajout</h3>
      <p class="text-gray-600 text-center mb-6">Êtes-vous sûr de vouloir ajouter <span id="confirmSeancesCount">0</span> séances ?</p>
      <div class="flex justify-center space-x-4">
        <button id="cancelSeancesConfirmBtn" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-button hover:bg-gray-50 whitespace-nowrap">
          Annuler
        </button>
        <button id="confirmSeancesConfirmBtn" class="px-4 py-2 bg-primary text-white rounded-button hover:bg-primary/90 whitespace-nowrap">
          Confirmer
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Success Notification -->
<div id="notification" class="notification">
    <div class="notification-icon">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
        </svg>
    </div>
    <div class="notification-content">
        <div class="notification-title" id="notificationTitle">Succès</div>
        <div class="notification-message" id="notificationMessage">Opération réussie !</div>
    </div>
    <div class="notification-close" onclick="this.parentElement.classList.remove('show')">&times;</div>
</div>

<script>
  const patientsData = {
    "Mekouar Zineb": {
      age: 32,
      avatar: "MZ",
      avatarBg: "bg-indigo-200",
      sessions: [
        { date: "10/04/2025", description: "Séance de rééducation motrice", duration: 45, doctor: "Mekouar Zineb", note: "Bonne évolution" },
        { date: "05/04/2025", description: "Séance de concentration", duration: 30, doctor: "Mekouar Zineb", note: "Amélioration" }
      ],
      anamnese: [{ date: "01/04/2025", summary: "Première évaluation psychomotrice" }],
      compteRendu: [{ date: "08/04/2025", title: "Bilan de 2e séance" }],
      totalSessions: 10,
      sessionCount: 2
    },
    "Jean Dupont": {
      age: 45,
      avatar: "JD",
      avatarBg: "bg-blue-200",
      sessions: [],
      anamnese: [],
      compteRendu: [],
      totalSessions: 5,
      sessionCount: 0
    },
    "Alice Durand": {
      age: 28,
      avatar: "AD",
      avatarBg: "bg-green-200",
      sessions: [{ date: "03/04/2025", description: "Séance comportementale", duration: 30, doctor: "Durand", note: "Observation neutre" }],
      anamnese: [],
      compteRendu: [],
      totalSessions: 8,
      sessionCount: 1
    },
    "Sophie Martin": {
      age: 35,
      avatar: "SM",
      avatarBg: "bg-pink-200",
      sessions: [],
      anamnese: [],
      compteRendu: [],
      totalSessions: 6,
      sessionCount: 0
    }
  };

  let currentPatientName = null;

  function openPatientRecords(patientName) {
  const patient = patientsData[patientName];
  if (!patient) return;

  currentPatientName = patientName;

  // Mise à jour avatar
  const avatarDiv = document.getElementById('dossierPatientAvatar');
  avatarDiv.textContent = patient.avatar;
  avatarDiv.className = `w-10 h-10 rounded-full ${patient.avatarBg} flex items-center justify-center text-white mr-3`;

  // Nom & âge
  document.getElementById('dossierPatientName').textContent = patientName;
  document.getElementById('dossierPatientAge').textContent = `${patient.age} ans`;

  // Sessions
  const total = patient.totalSessions || patient.sessions.length || 0;
  const done = patient.sessionCount || patient.sessions.length || 0;
  document.getElementById('patientRecordSessionsText').textContent = `${done}/${total} séances`;
  document.getElementById('patientRecordSessionsProgress').style.width = `${done && total ? (done / total) * 100 : 0}%`;
  document.getElementById('patientRecordSessions').textContent = `${total} séances`;

  const sessionHistoryContainer = document.getElementById('patientSessionHistory');
  if (patient.sessions.length > 0) {
    sessionHistoryContainer.innerHTML = patient.sessions.map(session => `
      <div class="p-4 hover:bg-gray-50 transition">
        <div class="flex justify-between mb-2">
          <div class="font-medium text-gray-900">Séance du ${session.date}</div>
          <div class="text-sm text-gray-500">${session.doctor || ''}</div>
        </div>
        <div class="text-sm text-gray-600 mb-3">
          <p>${session.note || session.description}</p>
        </div>
        <div class="flex justify-between items-center">
          <div class="text-xs text-gray-500">Durée: ${session.duration || '30'} minutes</div>
        </div>
      </div>
    `).join('');
  } else {
    sessionHistoryContainer.innerHTML = `<div class="p-4 text-center text-gray-500">Aucune séance enregistrée.</div>`;
  }

  // Anamnèses
  const anaContainer = document.getElementById('anamneseList');
  anaContainer.innerHTML = patient.anamnese.length
    ? patient.anamnese.map(item => `
      <div class="p-4 flex justify-between items-center">
        <div class="font-medium text-gray-900">Anamnèse du ${item.date}</div>
        <div class="flex items-center space-x-2">
          <button class="w-8 h-8 flex items-center justify-center text-blue-500 hover:text-blue-700"><i class="ri-eye-line"></i></button>
          <button class="w-8 h-8 flex items-center justify-center text-purple-500 hover:text-purple-700"><i class="ri-save-line"></i></button>
          <button class="w-8 h-8 flex items-center justify-center text-green-500 hover:text-green-700"><i class="ri-printer-line"></i></button>
        </div>
      </div>`).join('')
    : '<div class="p-4 text-center text-gray-500">Aucune anamnèse enregistrée.</div>';

  // Compte rendus
  const crContainer = document.getElementById('compteRenduList');
  crContainer.innerHTML = patient.compteRendu.length
    ? patient.compteRendu.map(item => `
      <div class="p-4 flex justify-between items-center">
        <div class="font-medium text-gray-900">Compte rendu du ${item.date}</div>
        <div class="flex items-center space-x-2">
          <button class="w-8 h-8 flex items-center justify-center text-blue-500 hover:text-blue-700"><i class="ri-eye-line"></i></button>
          <button class="w-8 h-8 flex items-center justify-center text-purple-500 hover:text-purple-700"><i class="ri-save-line"></i></button>
          <button class="w-8 h-8 flex items-center justify-center text-green-500 hover:text-green-700"><i class="ri-printer-line"></i></button>
        </div>
      </div>`).join('')
    : '<div class="p-4 text-center text-gray-500">Aucun compte rendu enregistré.</div>';

  // Onglet actif
  document.querySelectorAll('.records-tab-button').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.records-tab-content').forEach(tab => tab.classList.remove('active'));

  document.querySelector('[data-tab="sessionsTab"]').classList.add('active');
  document.getElementById('sessionsTab').classList.add('active');

  // Affiche la modale
  document.getElementById('patientDossierModal').classList.remove('hidden');
}

  function addToRecentPatients(patientName, lastVisit, appointmentType, statusClass) {
    const patient = patientsData[patientName];
    if (!patient) return;

    const tableBody = document.getElementById('recentPatientsTableBody');
    const today = new Date();
    const formattedDate = today.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric' });

    // Vérifier si le tableau est vide (avec le message "Aucun patient récent")
    if (tableBody.querySelector('td[colspan="4"]')) {
      tableBody.innerHTML = ''; // Supprimer le message "Aucun patient récent"
    }

    // Vérifier si le patient existe déjà dans le tableau
    let existingRow = null;
    document.querySelectorAll('#recentPatientsTableBody tr').forEach(row => {
      if (row.querySelector('p.font-medium.text-gray-800').textContent === patientName) {
        existingRow = row;
      }
    });

    if (existingRow) {
      // Mettre à jour la ligne existante
      existingRow.querySelector('td:nth-child(2)').textContent = formattedDate;
      existingRow.querySelector('td:nth-child(3) span').className = `px-2 py-1 text-xs rounded-full ${statusClass}`;
      existingRow.querySelector('td:nth-child(3) span').textContent = 
        statusClass === 'status-confirme' ? 'Confirmé' : 
        statusClass === 'status-annule' ? 'Annulé' : 'Reporté';
        
      // Déplacer la ligne en haut du tableau
      tableBody.insertBefore(existingRow, tableBody.firstChild);
    } else {
      // Créer une nouvelle ligne
      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td class="px-4 py-3 whitespace-nowrap">
          <div class="flex items-center">
            <div class="w-8 h-8 rounded-full ${patient.avatarBg} flex items-center justify-center text-white mr-3">
              <span class="text-xs font-medium">${patient.avatar}</span>
            </div>
            <div>
              <p class="font-medium text-gray-800">${patientName}</p>
              <p class="text-xs text-gray-500">${patient.age} ans</p>
            </div>
          </div>
        </td>
        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">${formattedDate}</td>
        <td class="px-4 py-3 whitespace-nowrap">
          <span class="px-2 py-1 text-xs rounded-full ${statusClass}">
            ${statusClass === 'status-confirme' ? 'Confirmé' : 
              statusClass === 'status-annule' ? 'Annulé' : 'Reporté'}
          </span>
        </td>
        <td class="px-4 py-3 whitespace-nowrap text-right text-sm">
          <button class="text-primary hover:text-primary/80 voir-dossier-btn" 
                  data-patient="${patientName}" 
                  data-age="${patient.age}" 
                  data-avatar="${patient.avatar}" 
                  data-avatar-bg="${patient.avatarBg}">
            Voir dossier
          </button>
        </td>
      `;

      // Ajouter la nouvelle ligne en haut du tableau
      tableBody.insertBefore(newRow, tableBody.firstChild);

      // Ajouter l'événement click au nouveau bouton "Voir dossier"
      newRow.querySelector('.voir-dossier-btn').addEventListener('click', function() {
        const patientName = this.getAttribute('data-patient');
        openPatientRecords(patientName);
      });
    }
  }

  function removeAppointment(patientName) {
    const appointmentsContainer = document.getElementById('appointmentsContainer');
    const appointmentItems = appointmentsContainer.querySelectorAll('.appointment-item');
    
    // Trouver et supprimer le rendez-vous correspondant
    appointmentItems.forEach(item => {
      if (item.querySelector('p.font-medium.text-gray-800').textContent === patientName) {
        item.remove();
      }
    });

    // Si c'était le rendez-vous actif, mettre à jour le prochain rendez-vous
    const activeAppointment = document.getElementById('activeAppointment');
    if (activeAppointment.querySelector('p.font-medium.text-gray-800').textContent === patientName) {
      if (appointmentItems.length > 0) {
        // Remplacer par le premier rendez-vous disponible
        const firstAppointment = appointmentItems[0];
        activeAppointment.querySelector('p.font-medium.text-gray-800').textContent = 
          firstAppointment.querySelector('p.font-medium.text-gray-800').textContent;
        activeAppointment.querySelector('p.text-sm.text-gray-600').textContent = 
          firstAppointment.querySelector('p.text-sm.text-gray-600').textContent;
        activeAppointment.querySelector('p.text-xs.text-gray-500').textContent = 
          firstAppointment.querySelector('p.text-xs.text-gray-500').textContent;
        activeAppointment.querySelector('.w-10.h-10').className = 
          firstAppointment.querySelector('.w-10.h-10').className;
        activeAppointment.querySelector('.w-10.h-10 span').textContent = 
          firstAppointment.querySelector('.w-10.h-10 span').textContent;
        
        // Supprimer le rendez-vous qui vient d'être promu
        firstAppointment.remove();
      } else {
        // Plus de rendez-vous, masquer la section active
        activeAppointment.style.display = 'none';
      }
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const openSidebarBtn = document.getElementById('openSidebarBtn');
    const closeSidebarBtn = document.getElementById('closeSidebarBtn');

    function toggleSidebar() {
      const isOpen = !sidebar.classList.contains('sidebar-hidden');
      
      if (isOpen) {
        // Fermer la sidebar
        sidebar.classList.add('sidebar-hidden');
        mainContent.classList.remove('ml-64');
        openSidebarBtn.classList.remove('hidden');
        closeSidebarBtn.classList.add('hidden');
      } else {
        // Ouvrir la sidebar
        sidebar.classList.remove('sidebar-hidden');
        mainContent.classList.add('ml-64');
        openSidebarBtn.classList.add('hidden');
        closeSidebarBtn.classList.remove('hidden');
      }
    }

    openSidebarBtn.addEventListener('click', toggleSidebar);
    closeSidebarBtn.addEventListener('click', toggleSidebar);

    // Initialisation (sidebar ouverte par défaut)
    sidebar.classList.remove('sidebar-hidden');
    mainContent.classList.add('ml-64');
    openSidebarBtn.classList.add('hidden');
    closeSidebarBtn.classList.remove('hidden');

    // 1. Gestion du menu déroulant Documents
    const documentsDropdown = document.getElementById('documentsDropdown');
    const documentsSubmenu = document.getElementById('documentsSubmenu');
    const dropdownArrow = document.getElementById('dropdownArrow');
    
    documentsDropdown.addEventListener('click', function(e) {
      e.preventDefault();
      documentsSubmenu.classList.toggle('show');
      
      if (documentsSubmenu.classList.contains('show')) {
        dropdownArrow.classList.remove('ri-arrow-down-s-line');
        dropdownArrow.classList.add('ri-arrow-up-s-line');
      } else {
        dropdownArrow.classList.remove('ri-arrow-up-s-line');
        dropdownArrow.classList.add('ri-arrow-down-s-line');
      }
    });

    // 2. Mise à jour de la date actuelle
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const today = new Date();
    document.getElementById('currentDate').textContent = today.toLocaleDateString('fr-FR', options);

    // 3. Gestion de la modal d'ajout de tâche
    const addTaskModal = document.getElementById('addTaskModal');
    const addTaskBtn = document.getElementById('addTaskBtn');
    const closeTaskBtn = document.getElementById('closeTaskBtn');
    const submitTaskBtn = document.getElementById('submitTaskBtn');
    const taskDaySelect = document.getElementById('taskDay');
    const specificDateContainer = document.getElementById('specificDateContainer');

    // Gestion du changement de jour pour la tâche
    taskDaySelect.addEventListener('change', function() {
      specificDateContainer.style.display = this.value === 'other' ? 'block' : 'none';
    });

    // Ouverture/fermeture de la modal de tâche
    addTaskBtn.addEventListener('click', () => addTaskModal.classList.remove('hidden'));
    closeTaskBtn.addEventListener('click', () => addTaskModal.classList.add('hidden'));

    // Soumission d'une nouvelle tâche
    submitTaskBtn.addEventListener('click', function() {
      const taskText = document.getElementById('taskText').value.trim();
      const taskDay = document.getElementById('taskDay').value;
      const taskHour = document.getElementById('taskHour').value;
      const specificDate = document.getElementById('specificDate').value;
      
      if (taskText) {
        const tasksContainer = document.getElementById('tasksContainer');
        
        // Formatage de la date
        let dateText = '';
        if (taskDay === 'today') {
          dateText = 'Aujourd\'hui';
        } else if (taskDay === 'tomorrow') {
          dateText = 'Demain';
        } else if (taskDay === 'other' && specificDate) {
          const dateObj = new Date(specificDate);
          dateText = dateObj.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }
        
        // Formatage de l'heure
        let hourText = '';
        if (taskHour) {
          const [hours, minutes] = taskHour.split(':');
          hourText = `${hours}:${minutes || '00'}`;
        }
        
        const fullDateText = dateText + (hourText ? `, ${hourText}` : '');
        
        // Création de la nouvelle tâche
        const newTask = document.createElement('div');
        newTask.className = 'flex items-center p-3 rounded-lg hover:bg-gray-50 border border-gray-100';
        newTask.innerHTML = `
          <div class="w-5 h-5 flex items-center justify-center mr-3">
            <input type="checkbox" class="form-checkbox h-4 w-4 text-primary rounded focus:ring-primary" onchange="toggleTask(this)">
          </div>
          <div class="flex-1">
            <p class="text-sm text-gray-800 task-text">${taskText}</p>
            <p class="text-xs text-gray-500 task-date">${fullDateText || 'Aucune date'}</p>
          </div>
        `;
        
        tasksContainer.prepend(newTask);
        document.getElementById('addTaskForm').reset();
        addTaskModal.classList.add('hidden');
      }
    });

    // 4. Gestion de la modal "Voir tous" pour les rendez-vous
    const viewAllAppointmentsBtn = document.getElementById('viewAllAppointmentsBtn');
    const allAppointmentsModal = document.getElementById('allAppointmentsModal');
    const closeAllAppointmentsBtn = document.getElementById('closeAllAppointmentsBtn');

    viewAllAppointmentsBtn.addEventListener('click', function() {
      allAppointmentsModal.classList.remove('hidden');
    });

    closeAllAppointmentsBtn.addEventListener('click', function() {
      allAppointmentsModal.classList.add('hidden');
    });

    // 5. Gestion de la modal "Voir tous" pour les patients
    const viewAllPatientsBtn = document.getElementById('viewAllPatientsBtn');
    const allPatientsModal = document.getElementById('allPatientsModal');
    const closeAllPatientsBtn = document.getElementById('closeAllPatientsBtn');

    viewAllPatientsBtn.addEventListener('click', function() {
      allPatientsModal.classList.remove('hidden');
    });

    closeAllPatientsBtn.addEventListener('click', function() {
      allPatientsModal.classList.add('hidden');
    });

    // 6. Gestion de la modal "Voir dossier" pour les patients
    const patientDossierModal = document.getElementById('patientDossierModal');
    const closeDossierBtn = document.getElementById('closeDossierBtn');
    const voirDossierBtns = document.querySelectorAll('.voir-dossier-btn');

    voirDossierBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        const patientName = this.getAttribute('data-patient');
        openPatientRecords(patientName);
      });
    });

    closeDossierBtn.addEventListener('click', function() {
      patientDossierModal.classList.add('hidden');
    });

    // Gestion des onglets dans la modal dossier patient
    document.querySelectorAll('.records-tab-button').forEach(button => {
      button.addEventListener('click', function() {
        const tabId = this.getAttribute('data-tab');
        
        // Retirer la classe active de tous les boutons et contenus
        document.querySelectorAll('.records-tab-button').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.records-tab-content').forEach(content => content.classList.remove('active'));
        
        // Ajouter la classe active au bouton et au contenu cliqué
        this.classList.add('active');
        document.getElementById(tabId).classList.add('active');
      });
    });

    // 7. Fonction pour basculer l'état d'une tâche
    window.toggleTask = function(checkbox) {
      const parentDiv = checkbox.parentElement.parentElement;
      const taskTextElement = parentDiv.querySelector('.task-text') || parentDiv.querySelector('p:first-of-type');
      const taskDateElement = parentDiv.querySelector('.task-date') || parentDiv.querySelector('p:last-of-type');
      
      if (checkbox.checked) {
        // Style exactement comme dans tableau de bord.html
        taskTextElement.style.textDecoration = 'line-through';
        taskTextElement.style.color = 'text-gray-500'; // Gris comme pour "Appeler laboratoire pour résultats"
        taskDateElement.style.color = 'text-gray-400'; // Gris très clair comme pour "Aujourd'hui, 10:00"
        parentDiv.style.backgroundColor = '#f9fafb'; // Léger gris de fond
        
        // Programmer la suppression après 2 heures
        setTimeout(() => {
          if (parentDiv && parentDiv.parentNode) {
            parentDiv.parentNode.removeChild(parentDiv);
          }
        }, 2 * 60 * 60 * 1000);
      } else {
        // Réinitialiser les styles
        taskTextElement.style.textDecoration = '';
        taskTextElement.style.color = '';
        taskDateElement.style.color = '';
        parentDiv.style.backgroundColor = '';
      }
    };

    // Gestion de l'ajout de séances
    document.getElementById('addSessionBtn')?.addEventListener('click', function() {
      const patient = patientsData[currentPatientName];
      if (!patient) return;
      
      // Pré-remplir avec le nombre de séances actuelles
      document.getElementById('currentSeancesDisplay').value = patient.totalSessions || 0;
      document.getElementById('additionalSeances').value = 1;
      document.getElementById('totalSeancesDisplay').value = (patient.totalSessions || 0) + 1;
      
      // Afficher la modal
      document.getElementById('addSeancesModal').classList.remove('hidden');
    });

    // Mise à jour du total des séances lors de la modification
    document.getElementById('additionalSeances')?.addEventListener('input', function() {
      const currentSeances = parseInt(document.getElementById('currentSeancesDisplay').value) || 0;
      const additionalSeances = parseInt(this.value) || 0;
      document.getElementById('totalSeancesDisplay').value = currentSeances + additionalSeances;
    });

    // Fermeture des modals
    document.getElementById('closeAddSeancesBtn')?.addEventListener('click', function() {
      document.getElementById('addSeancesModal').classList.add('hidden');
    });

    document.getElementById('cancelAddSeancesBtn')?.addEventListener('click', function() {
      document.getElementById('addSeancesModal').classList.add('hidden');
    });

    // Confirmation d'ajout de séances
    document.getElementById('submitAddSeancesBtn')?.addEventListener('click', function() {
      const additionalSeances = parseInt(document.getElementById('additionalSeances').value) || 0;
      if (additionalSeances <= 0) {
        showNotification('error', 'Veuillez entrer un nombre valide de séances à ajouter');
        return;
      }
      
      document.getElementById('confirmSeancesCount').textContent = additionalSeances;
      document.getElementById('addSeancesModal').classList.add('hidden');
      document.getElementById('seancesConfirmModal').classList.remove('hidden');
    });

    // Validation finale de l'ajout de séances
    document.getElementById('confirmSeancesConfirmBtn')?.addEventListener('click', function() {
      const additionalSeances = parseInt(document.getElementById('additionalSeances').value) || 0;
      const patient = patientsData[currentPatientName];

      if (patient) {
        // Mise à jour du nombre total de séances
        patient.totalSessions = (patient.totalSessions || 0) + additionalSeances;
        
        // Mise à jour de la date de dernière visite
        const today = new Date();
        patient.lastVisit = today.toISOString().split('T')[0];
        
        // Mise à jour de l'affichage
        openPatientRecords(currentPatientName);
        
        // Fermer la modal
        document.getElementById('seancesConfirmModal').classList.add('hidden');
        
        // Notification
        showNotification('success', `${additionalSeances} séance(s) ajoutée(s) avec succès.`);
      }
    });

    // Annulation de la confirmation
    document.getElementById('cancelSeancesConfirmBtn')?.addEventListener('click', function() {
      document.getElementById('seancesConfirmModal').classList.add('hidden');
    });

    // 8. Gestion du rendez-vous actif
    const rescheduleBtn = document.getElementById('rescheduleBtn');
    const rescheduleContainer = document.getElementById('rescheduleContainer');
    const validateRescheduleBtn = document.getElementById('validateRescheduleBtn');
    const confirmBtn = document.getElementById('confirmBtn');
    const confirmContainer = document.getElementById('confirmContainer');
    const validateConfirmBtn = document.getElementById('validateConfirmBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const activeAppointment = document.getElementById('activeAppointment');
    
    // Gestion du bouton "Confirmer"
    confirmBtn.addEventListener('click', function() {
      // Masquer d'abord le conteneur de report s'il est visible
      rescheduleContainer.classList.add('hidden');
      
      // Afficher le conteneur de confirmation
      confirmContainer.classList.remove('hidden');
      
      // Focus sur le champ d'observation
      document.getElementById('confirmNote').focus();
      
      // Faire défiler jusqu'au conteneur
      confirmContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });

    validateConfirmBtn.addEventListener('click', function() {
      const note = document.getElementById('confirmNote').value.trim();
      const today = new Date();
      const formattedDate = today.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric' });
      
      // Récupérer les infos du patient
      const patientName = document.querySelector('#activeAppointment p.font-medium.text-gray-800').textContent;
      const appointmentTime = document.querySelector('#activeAppointment p.text-sm.text-gray-600').textContent;
      const appointmentType = document.querySelector('#activeAppointment p.text-xs.text-gray-500').textContent;
      
      // Ajouter la séance à l'historique du patient
      if (patientsData[patientName]) {
        patientsData[patientName].sessions.unshift({
          date: formattedDate,
          description: appointmentType,
          duration: 60, // Durée par défaut
          doctor: "Mekouar Zineb",
          note: note || "Séance confirmée sans observation"
        });
        patientsData[patientName].sessionCount = (patientsData[patientName].sessionCount || 0) + 1;
      }
      
      // Afficher une notification de succès
      Swal.fire({
          title: 'Rendez-vous confirmé !',
          text: note ? 'Une observation a été ajoutée.' : 'Le rendez-vous a été marqué comme confirmé.',
          icon: 'success',
          confirmButtonColor: '#4f46e5'
      });
          
      // Cacher le conteneur
      confirmContainer.classList.add('hidden');
      
      // Vider le champ
      document.getElementById('confirmNote').value = '';
      
      // Mise à jour visuelle du statut
      const statusElement = document.getElementById('appointmentStatus');
      statusElement.classList.remove('bg-blue-100');
      statusElement.classList.remove('text-blue-800');
      statusElement.classList.add('bg-green-100');
      statusElement.classList.add('text-green-800');
      statusElement.textContent = 'Confirmé';
      
      // Ajouter à la section Patients Récents
      addToRecentPatients(patientName, appointmentTime, appointmentType, 'status-confirme');
      
      // Supprimer le rendez-vous de la section Prochains Rendez-vous
      removeAppointment(patientName);
      
      // Mettre à jour la barre de progression si le dossier patient est ouvert
      if (currentPatientName === patientName) {
          const total = patientsData[patientName].totalSessions || 0;
          const done = patientsData[patientName].sessionCount || 0;
          document.getElementById('patientRecordSessionsProgress').style.width = `${(done / total) * 100}%`;
          document.getElementById('patientRecordSessionsText').textContent = `${done}/${total} séances`;
      }
    });
    
    // Gestion du bouton "Reporter"
    rescheduleBtn.addEventListener('click', function() {
      // Masquer d'abord le conteneur de confirmation s'il est visible
      confirmContainer.classList.add('hidden');
      
      // Définir la date par défaut à demain
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.getElementById('rescheduleDate').valueAsDate = tomorrow;
      
      // Définir l'heure par défaut (même heure)
      document.getElementById('rescheduleTime').value = '10:00';
      
      // Afficher le conteneur de report
      rescheduleContainer.classList.toggle('hidden');
      
      // Si on affiche la zone, on fait défiler jusqu'à elle
      if (!rescheduleContainer.classList.contains('hidden')) {
        rescheduleContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    });

    // Gestion du bouton "Valider le report"
    validateRescheduleBtn.addEventListener('click', function() {
      const newDate = document.getElementById('rescheduleDate').value;
      const newTime = document.getElementById('rescheduleTime').value;
      
      if (!newDate || !newTime) {
        Swal.fire({
          title: 'Attention',
          text: 'Veuillez sélectionner une date et une heure pour le report.',
          icon: 'warning',
          confirmButtonColor: '#4f46e5'
        });
        return;
      }
      
      // Formatage de la date pour l'affichage
      const dateObj = new Date(newDate + 'T' + newTime);
      const formattedDate = dateObj.toLocaleDateString('fr-FR', { 
        weekday: 'long', 
        day: 'numeric', 
        month: 'long', 
        year: 'numeric' 
      });
      const formattedTime = newTime;
      
      Swal.fire({
        title: 'Rendez-vous reporté !',
        text: `Rendez-vous reporté au ${formattedDate} à ${formattedTime}.`,
        icon: 'success',
        confirmButtonColor: '#4f46e5'
      });
          
      rescheduleContainer.classList.add('hidden');
      
      // Mise à jour visuelle du statut
      const statusElement = document.getElementById('appointmentStatus');
      statusElement.classList.remove('bg-green-100');
      statusElement.classList.remove('text-green-800');
      statusElement.classList.add('bg-yellow-100');
      statusElement.classList.add('text-yellow-800');
      statusElement.textContent = 'Reporté';
      
      // Mise à jour de la date et heure affichées
      const timeElement = activeAppointment.querySelector('p.text-sm.text-gray-600');
      timeElement.textContent = `${formattedDate}, ${formattedTime.substring(0, 5)}`;
      
      // Récupérer les infos du patient
      const patientName = document.querySelector('#activeAppointment p.font-medium.text-gray-800').textContent;
      const appointmentType = document.querySelector('#activeAppointment p.text-xs.text-gray-500').textContent;
      
      // Ajouter à la section Patients Récents
      addToRecentPatients(patientName, `${formattedDate}, ${formattedTime.substring(0, 5)}`, appointmentType, 'status-reporte');
      
      // Supprimer le rendez-vous de la section Prochains Rendez-vous
      removeAppointment(patientName);
    });
    
    // Gestion du bouton "Annuler"
    cancelBtn.addEventListener('click', function() {
      // D'abord, masquer les conteneurs de confirmation et de report s'ils sont visibles
      confirmContainer.classList.add('hidden');
      rescheduleContainer.classList.add('hidden');
      
      Swal.fire({
        title: 'Êtes-vous sûr ?',
        text: 'Voulez-vous vraiment annuler ce rendez-vous ?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        cancelButtonColor: '#6b7280',
        confirmButtonText: 'Oui, annuler',
        cancelButtonText: 'Non'
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire({
            title: 'Rendez-vous annulé !',
            text: 'Le rendez-vous a été annulé avec succès.',
            icon: 'success',
            confirmButtonColor: '#4f46e5'
          });
          
          // Mise à jour visuelle du statut
          const statusElement = document.getElementById('appointmentStatus');
          statusElement.classList.remove('bg-green-100');
          statusElement.classList.remove('text-green-800');
          statusElement.classList.add('bg-red-100');
          statusElement.classList.add('text-red-800');
          statusElement.textContent = 'Annulé';
          
          // Récupérer les infos du patient
          const patientName = document.querySelector('#activeAppointment p.font-medium.text-gray-800').textContent;
          const appointmentTime = document.querySelector('#activeAppointment p.text-sm.text-gray-600').textContent;
          const appointmentType = document.querySelector('#activeAppointment p.text-xs.text-gray-500').textContent;
          
          // Ajouter à la section Patients Récents
          addToRecentPatients(patientName, appointmentTime, appointmentType, 'status-annule');
          
          // Supprimer le rendez-vous de la section Prochains Rendez-vous
          removeAppointment(patientName);
        }
      });
    });

    // Gestion du bouton "Nouveau Patient"
    document.getElementById('newPatientBtn').addEventListener('click', function() {
      showNotification('info', 'Redirection vers le formulaire de nouveau patient');
    });

    // Fonction pour afficher les notifications
    function showNotification(type, message) {
      const notification = document.getElementById('notification');
      const notificationTitle = document.getElementById('notificationTitle');
      const notificationMessage = document.getElementById('notificationMessage');
      const notificationIcon = notification.querySelector('.notification-icon svg');
      
      // Configuration basée sur le type
      switch(type) {
        case 'success':
          notification.style.borderLeftColor = '#10b981';
          notification.querySelector('.notification-icon').style.color = '#10b981';
          notificationIcon.innerHTML = '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />';
          notificationTitle.textContent = 'Succès';
          break;
        case 'error':
          notification.style.borderLeftColor = '#ef4444';
          notification.querySelector('.notification-icon').style.color = '#ef4444';
          notificationIcon.innerHTML = '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />';
          notificationTitle.textContent = 'Erreur';
          break;
        case 'info':
          notification.style.borderLeftColor = '#3b82f6';
          notification.querySelector('.notification-icon').style.color = '#3b82f6';
          notificationIcon.innerHTML = '<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z" clip-rule="evenodd" />';
          notificationTitle.textContent = 'Information';
          break;
      }
      
      notificationMessage.textContent = message;
      
      notification.classList.add('show');
      
      // Masquer automatiquement après 5 secondes
      setTimeout(() => {
        notification.classList.remove('show');
      }, 5000);
    }

    // Vérifier les tâches à charger la page
    // Récupérer les tâches complétées du stockage local
    const completedTasks = JSON.parse(localStorage.getItem('completedTasks') || '{}');
    const currentTime = Date.now();
    
    // Parcourir toutes les tâches dans le DOM
    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
      const taskContainer = checkbox.closest('.flex');
      
      // Pour les tâches déjà cochées
      if (checkbox.checked) {
        toggleTask(checkbox);
      }
    });
    
    // Vérifier et supprimer les tâches périmées
    checkCompletedTasks();
    
    // Vérifier toutes les 15 minutes
    setInterval(checkCompletedTasks, 15 * 60 * 1000);

    function checkCompletedTasks() {
      const completedTasks = JSON.parse(localStorage.getItem('completedTasks') || '{}');
      const currentTime = Date.now();
      const twoHoursInMs = 2 * 60 * 60 * 1000;
      let tasksUpdated = false;
      
      // Parcourir toutes les tâches complétées
      Object.keys(completedTasks).forEach(taskId => {
        const completionTime = completedTasks[taskId];
        
        // Si la tâche a été complétée il y a plus de 2 heures
        if (currentTime - completionTime >= twoHoursInMs) {
          // Supprimer la tâche du DOM si elle existe
          const taskElement = document.querySelector(`.flex[data-task-id="${taskId}"]`);
          if (taskElement && taskElement.parentNode) {
            taskElement.parentNode.removeChild(taskElement);
          }
          
          // Supprimer du stockage local
          delete completedTasks[taskId];
          tasksUpdated = true;
        }
      });
      
      // Mettre à jour le stockage local si nécessaire
      if (tasksUpdated) {
        localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
      }
    }
  });
</script>
</body>
</html>